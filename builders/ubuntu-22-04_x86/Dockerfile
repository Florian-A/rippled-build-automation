FROM ubuntu:22.04

# Set environment variables
ARG CACHEBUST=5
ARG GCC_VERSION=11
ENV GCC_VERSION=${GCC_VERSION}
ARG CLANG_VERSION=14
ENV CLANG_VERSION=${CLANG_VERSION}
ARG CONAN_VERSION=1.60.0
ENV CONAN_VERSION=${CONAN_VERSION}
ARG GCOVR_VERSION=6.0
ENV GCOVR_VERSION=${GCOVR_VERSION}
ARG CMAKE_VERSION=3.25.1
ENV CMAKE_VERSION=${CMAKE_VERSION}
ARG CMAKE_HASH="3a5008b613eeb0724edeb3c15bf91d6ce518eb8eebc6ee758f89a0f4ff5d1fd6"
ENV CMAKE_HASH=${CMAKE_HASH}
ARG RIPPLED_VERSION=2.2.3
ENV RIPPLED_VERSION=${RIPPLED_VERSION}
ARG RIPPLED_HASH="34f8a703765caba0cd21b3e703c2c225a2634c5cfde5239c74921721f1d02cf3"
ENV RIPPLED_HASH=${RIPPLED_HASH}

RUN mkdir /build
RUN  cp /bin/bash /build/

# # Install prerequisites
WORKDIR /root
COPY prerequisites.sh .
RUN ./prerequisites.sh

# # Make rippled build
WORKDIR /root
COPY compilation.sh .
RUN ./compilation.sh

# # Copy rippled binary
RUN cp /build/rippled-2.2.3/.build/rippled /tmp/rippled